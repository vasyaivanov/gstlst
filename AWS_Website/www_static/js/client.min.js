!function(e,t,n){"function"==typeof define&&define.amd?define(t,n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}(this,"SocketIOFileUpload",function(){return function(e){"use strict";var t=this;if(!window.File||!window.FileReader)throw new Error("Socket.IO File Upload: Browser Not Supported");var n={},i=[],r=[];t.fileInputElementId="siofu_input",t.useText=!1,t.serializedOctets=!1,t.useBuffer=!0,t.chunkSize=102400;var o=function(e,n){var i=document.createEvent("Event");i.initEvent(e,!1,!1);for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);return t.dispatchEvent(i)},s=[],u=function(e,t,n,i){e.addEventListener(t,n,i),s.push(arguments)},a=function(e,t,n,i){e.removeEventListener&&e.removeEventListener(t,n,i)},f=function(){for(var e=s.length-1;e>=0;e--)a.apply(this,s[e]);s=[]},d=function(n){if(null!==t.maxFileSize&&n.size>t.maxFileSize)return void o("error",{file:n,message:"Attempt by client to upload file exceeding the maximum file size",code:1});var s=o("start",{file:n});if(s){var f,d=new FileReader,l=i.length,c=t.useText,m=0;d._realReader&&(d=d._realReader),i.push(n);var v=t.chunkSize;(v>=n.size||0>=v)&&(v=n.size);var p=function(i,r,o){var s=!1;if(!c)try{var u=new Uint8Array(o);t.serializedOctets?o=u:t.useBuffer?o=u.buffer:(s=!0,o=h(u))}catch(a){return void e.emit("siofu_done",{id:l,interrupt:!0})}e.emit("siofu_progress",{id:l,size:n.size,start:i,end:r,content:o,base64:s})},g=function(){e.emit("siofu_done",{id:l})},E=function(){var e=n.slice(m,Math.min(m+v,n.size));c?d.readAsText(e):d.readAsArrayBuffer(e)},y=function(e){var t=Math.min(m+v,n.size);p(m,t,e.target.result),o("progress",{file:n,bytesLoaded:t,name:f}),m+=v,m<n.size?E():(g(),o("load",{file:n,reader:d,name:f}))};u(d,"load",y),u(d,"error",function(){e.emit("siofu_done",{id:l,interrupt:!0}),a(d,"load",y)}),u(d,"abort",function(){e.emit("siofu_done",{id:l,interrupt:!0}),a(d,"load",y)}),e.emit("siofu_start",{name:n.name,mtime:n.lastModifiedDate,meta:n.meta,size:n.size,encoding:c?"text":"octet",id:l});var b=function(e){f=e,E()};r.push(b)}},l=function(e){for(var t=0;t<e.length;t++)d(e[t])},c=function(){var e=document.getElementById(t.fileInputElementId);return e||(e=document.createElement("input"),e.setAttribute("type","file"),e.setAttribute("id",t.fileInputElementId),e.style.display="none",document.body.appendChild(e)),e},m=function(){var e=document.getElementById(t.fileInputElementId);e&&e.parentNode.removeChild(e)},v=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)e[t].meta||(e[t].meta={});var n=o("choose",{files:e});n&&l(e)}},p=function(e){var t=e.target.files||e.dataTransfer.files;e.preventDefault(),v(t)};this.submitFiles=function(e){e&&v(e)},this.listenOnSubmit=function(e,t){t.files&&u(e,"click",function(){v(t.files)},!1)},this.listenOnArraySubmit=function(e,t){for(var n in t)this.listenOnSubmit(e,t[n])},this.listenOnInput=function(e){e.files&&u(e,"change",p,!1)},this.listenOnDrop=function(e){u(e,"dragover",function(e){e.preventDefault()},!1),u(e,"drop",p)},this.prompt=function(){var e=c();u(e,"change",p,!1);var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)},this.destroy=function(){f(),m(),n={},i=[],r=[]},this.addEventListener=function(e,t){n[e]||(n[e]=[]),n[e].push(t)},this.removeEventListener=function(e,t){if(!n[e])return!1;for(var i=0;i<n[e].length;i++)if(n[e][i]===t)return n[e].splice(i,1),!0;return!1},this.dispatchEvent=function(e){var t=n[e.type];if(!t)return!0;for(var i=!0,r=0;r<t.length;r++){var o=t[r](e);o===!1&&(i=!1)}return i};var h=function(e){var t,n=e.buffer.byteLength,i="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;n>t;t+=3)i+=r[e[t]>>2],i+=r[(3&e[t])<<4|e[t+1]>>4],i+=r[(15&e[t+1])<<2|e[t+2]>>6],i+=r[63&e[t+2]];return n%3===2?i=i.substring(0,i.length-1)+"=":n%3===1&&(i=i.substring(0,i.length-2)+"=="),i};u(e,"siofu_ready",function(e){r[e.id](e.name)}),u(e,"siofu_complete",function(e){o("complete",{file:i[e.id],detail:e.detail,success:e.success})}),u(e,"siofu_error",function(e){o("error",{file:i[e.id],message:e.message,code:0})})}});